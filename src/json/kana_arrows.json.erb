<%=
require "json"
JAPANESE_KANA_PRESEED = "japanese_kana pressed"
KEYMAPS = [
    {h: "left_arrow", j: "down_arrow", k: "up_arrow", l: "right_arrow", o: "delete_or_backspace", semicolon: "return_or_enter"},
    {i: "up_arrow", j: "left_arrow", k: "up_arrow", l: "right_arrow", o: "delete_or_backspace", semicolon: "return_or_enter"},
]

rules = KEYMAPS.map {|keymap|
    {
        description: "かな + #{keymap.keys[0..3].map(&:to_s).join} to arrow keys",
        manipulators: [
            *keymap.map {|from, to|
                {
                    type: "basic",
                    from: {
                        key_code: from,
                        modifiers: {optional: %w(any)},
                    },
                    to: [{
                        key_code: to,
                    }],
                    conditions: [{
                        type: "variable_if",
                        name: JAPANESE_KANA_PRESEED,
                        value: 1,
                    }],
                }
            },
            {
                type: "basic",
                from: {
                    key_code: "japanese_kana",
                    modifiers: {optional: %w(any)},
                },
                to: [{
                    set_variable: {
                        name: JAPANESE_KANA_PRESEED,
                        value: 1,
                    },
                }],
                to_if_alone: [{
                    key_code: "japanese_kana",
                }],
                to_after_key_up: [{
                    set_variable: {
                        name: JAPANESE_KANA_PRESEED,
                        value: 0,
                    },
                }]
            },
        ],
    }
}

h = {
    title: "かな + hjkl/ijkl to arrow keys",
    rules: rules,
}

JSON.pretty_generate(h)
%>
